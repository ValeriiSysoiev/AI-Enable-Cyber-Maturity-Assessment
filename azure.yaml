name: multi-agent-custom-automation-engine
platform: python
platformVersion: 3.11

services:
  backend:
    project: src/backend
    host: containerapp
    language: python
    docker:
      path: src/backend/Dockerfile.azure
      context: src/backend
    env:
      - name: AZURE_OPENAI_ENDPOINT
        value: "${AZURE_OPENAI_ENDPOINT}"
      - name: AZURE_OPENAI_DEPLOYMENT_NAME
        value: "${AZURE_OPENAI_DEPLOYMENT_NAME}"
      - name: AZURE_OPENAI_API_VERSION
        value: "${AZURE_OPENAI_API_VERSION}"
      - name: COSMOSDB_ENDPOINT
        value: "${COSMOSDB_ENDPOINT}"
      - name: COSMOSDB_DATABASE
        value: "${COSMOSDB_DATABASE}"
      - name: COSMOSDB_CONTAINER
        value: "${COSMOSDB_CONTAINER}"
      - name: APPLICATIONINSIGHTS_CONNECTION_STRING
        value: "${APPLICATIONINSIGHTS_CONNECTION_STRING}"
      - name: AZURE_AI_PROJECT_ENDPOINT
        value: "${AZURE_AI_PROJECT_ENDPOINT}"
      - name: AZURE_AI_SUBSCRIPTION_ID
        value: "${AZURE_AI_SUBSCRIPTION_ID}"
      - name: AZURE_AI_RESOURCE_GROUP
        value: "${AZURE_AI_RESOURCE_GROUP}"
      - name: AZURE_AI_PROJECT_NAME
        value: "${AZURE_AI_PROJECT_NAME}"

  frontend:
    project: src/frontend
    host: containerapp
    language: python
    docker:
      path: src/frontend/Dockerfile
      context: src/frontend

infra:
  path: infra
  provider: bicep
  parameters:
    - name: useWafAlignedArchitecture
      value: false
    - name: solutionPrefix
      value: "macae-${AZURE_ENV_NAME}"
    - name: solutionLocation
      value: "${AZURE_LOCATION}"
    - name: aiDeploymentsLocation
      value: "${AZURE_LOCATION}"
    - name: gptModelName
      value: "gpt-4"
    - name: gptModelVersion
      value: "2024-08-06"
    - name: gptModelCapacity
      value: 150
